<DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Maestro VIP Final</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --gold: #f1c40f; --success: #27ae60; --accent: #3498db; --danger: #e74c3c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; touch-action: manipulation; }

        /* LOGIN */
        #pantalla-login { position: fixed; inset: 0; background: linear-gradient(135deg, var(--primary), #1a252f); display: flex; justify-content: center; align-items: center; z-index: 5000; }
        .caja-login { background: white; padding: 35px; border-radius: 30px; text-align: center; width: 85%; max-width: 400px; }
        .input-login { width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 15px; font-size: 18px; margin-bottom: 20px; outline: none; text-align: center; }
        .btn-entrar { width: 100%; padding: 15px; border: none; background: var(--accent); color: white; font-size: 18px; font-weight: bold; border-radius: 15px; cursor: pointer; }

        /* INTERFAZ PRINCIPAL */
        #interfaz-juego { display: none; flex-direction: column; align-items: center; min-height: 100vh; }
        .panel-superior { position: sticky; top: 0; background: var(--primary); width: 100%; padding: 10px 0; z-index: 1000; text-align: center; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        
        .btn-estado-vip { background: var(--success); color: white; border: none; padding: 8px 18px; border-radius: 20px; font-weight: bold; cursor: pointer; margin: 0 auto; display: block; }
        .btn-cancelar-vip { background: none; color: #ff9f9f; border: 1px solid #ff9f9f; padding: 4px 12px; border-radius: 5px; font-size: 11px; cursor: pointer; margin-top: 8px; display: none; }
        .es-vip .btn-cancelar-vip { display: inline-block; }

        /* SELECTOR DE COLORES (DESCRIPCIÃ“N VIP) */
        .selector-colores { display: none; gap: 10px; justify-content: center; margin: 10px 0; }
        .es-vip .selector-colores { display: flex; }
        .dot-color { width: 25px; height: 25px; border-radius: 50%; border: 2px solid transparent; cursor: pointer; }
        .dot-color.activo { border-color: white; transform: scale(1.2); }

        /* MARCADOR */
        .contenedor-marcador { display: flex; align-items: center; justify-content: center; gap: 15px; margin: 10px 0; }
        #marcador-visual { background: #eaeff2; color: #333; padding: 15px; border-radius: 15px; font-size: 40px; font-weight: bold; width: 85px; text-align: center; border: 2px solid #ccc; }
        .btn-ok { width: 75px; height: 75px; border-radius: 50%; border: none; background: var(--success); color: white; font-weight: bold; font-size: 22px; cursor: pointer; }

        /* TABLEROS */
        .contenedor-tableros { display: flex; flex-direction: column; gap: 20px; align-items: center; padding: 20px; width: 100%; box-sizing: border-box; }
        .tablero { background: white; padding: 12px; border-radius: 15px; border: 2px solid #ddd; position: relative; width: 100%; max-width: 320px; transition: order 0.5s ease; }
        
        /* GESTIÃ“N DE JUGADORES (DESCRIPCIÃ“N VIP) */
        .cabecera-vip { display: none; flex-direction: column; gap: 4px; margin-bottom: 10px; }
        .es-vip .cabecera-vip { display: flex; }
        .input-info { width: 100%; font-size: 12px; padding: 6px; border: 1px solid #eee; border-radius: 6px; box-sizing: border-box; font-weight: bold; }

        .cuadricula { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .celda { width: 100%; aspect-ratio: 1/1; border: 1px solid #ddd; border-radius: 8px; text-align: center; font-size: 20px; font-weight: bold; outline: none; background: #fff; padding: 0; }
        .centro { background: #2c3e50 !important; color: white !important; font-size: 8px !important; display: flex; align-items: center; justify-content: center; border: none; }
        
        /* COLORES DE MARCADO VIP */
        .marcado-rojo { background: #ff5f6d !important; color: white !important; }
        .marcado-azul { background: #3498db !important; color: white !important; }
        .marcado-verde { background: #2ecc71 !important; color: white !important; }
        .marcado-amarillo { background: var(--gold) !important; color: #2c3e50 !important; }

        /* MODAL VIP */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 3000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .tarjeta-modal { background: white; width: 85%; max-width: 360px; border-radius: 35px; padding: 30px; text-align: center; }
        .beneficio-item { display: flex; align-items: flex-start; text-align: left; margin-bottom: 12px; font-size: 14px; gap: 10px; }
    </style>
</head>
<body>

    <div id="pantalla-login">
        <div class="caja-login">
            <h1 style="color: var(--primary); margin:0;">BINGO PRO</h1>
            <input type="text" id="nombreUsuario" class="input-login" placeholder="Operador">
            <button class="btn-entrar" onclick="ingresar()">ENTRAR</button>
        </div>
    </div>

    <div id="interfaz-juego">
        <div class="panel-superior">
            <button id="btn-estado" class="btn-estado-vip" onclick="abrirVIP()">ðŸ‘‘ ACTIVAR PRUEBA GRATIS</button>
            <button class="btn-cancelar-vip" onclick="confirmarCancelacion()">Cancelar SuscripciÃ³n</button>
            
            <div id="saludo" style="font-size: 11px; margin-top:5px; opacity: 0.8;">HOLA</div>

            <div class="selector-colores" id="colores-vip">
                <div class="dot-color" style="background:#ff5f6d" onclick="setCol('rojo', this)"></div>
                <div class="dot-color" style="background:#3498db" onclick="setCol('azul', this)"></div>
                <div class="dot-color" style="background:#2ecc71" onclick="setCol('verde', this)"></div>
                <div class="dot-color activo" style="background:var(--gold)" onclick="setCol('amarillo', this)"></div>
            </div>

            <div class="contenedor-marcador">
                <button onclick="deshacerUltimo()" style="background:none; border:none; color:white; font-size:24px;">â†©</button>
                <div id="marcador-visual" onclick="document.getElementById('numEntrada').focus()">00</div>
                <button class="btn-ok" onclick="presionarOK()">OK</button>
            </div>
            <input type="number" id="numEntrada" style="opacity:0; position:absolute; top:-100px;" oninput="document.getElementById('marcador-visual').innerText = this.value.padStart(2,'0')">
            
            <button onclick="intentarAÃ±adirTablon()" style="padding:10px 25px; border:none; border-radius:12px; font-weight:bold; background: white; color: var(--primary);">+ AÃ‘ADIR CARTÃ“N</button>
        </div>

        <div class="contenedor-tableros" id="contenedor"></div>
    </div>

    <div id="modal-vip" class="modal">
        <div class="tarjeta-modal">
            <h2 style="margin-top:0;">SÃ‰ UN MAESTRO VIP ðŸ‘‘</h2>
            <div class="beneficio-item"><span>âœ”</span><strong>EdiciÃ³n de NÃºmeros:</strong> Coloca manualmente los nÃºmeros de tus cartones.</div>
            <div class="beneficio-item"><span>âœ”</span><strong>Orden Inteligente:</strong> Los cartones por ganar suben de primero.</div>
            <div class="beneficio-item"><span>âœ”</span><strong>GestiÃ³n de Jugadores:</strong> Guarda nombres, series y vendedores.</div>
            <div class="beneficio-item"><span>âœ”</span><strong>Auto-Guardado:</strong> No pierdas datos al cerrar.</div>
            
            <div style="font-size: 28px; font-weight: 800; color: var(--success); margin: 15px 0;">$4.99 / Mes</div>
            <p style="font-size: 12px; color: #999;">(DespuÃ©s de 3 dÃ­as gratis)</p>

            <button onclick="procesarPago()" style="background:var(--accent); border:none; padding:18px; width:100%; border-radius:20px; color:white; font-weight:bold; font-size:16px; cursor:pointer;">INICIAR PRUEBA GRATIS</button>
            <button onclick="cerrarModal()" style="background:none; border:none; color:gray; margin-top:15px; cursor:pointer;">Cerrar</button>
        </div>
    </div>

    <script>
        let esVIP = false;
        let colorActual = 'amarillo';
        let ultimoNumero = "";

        function ingresar() {
            if(!document.getElementById('nombreUsuario').value) return;
            document.getElementById('saludo').innerText = "OP: " + document.getElementById('nombreUsuario').value.toUpperCase();
            document.getElementById('pantalla-login').style.display = 'none';
            document.getElementById('interfaz-juego').style.display = 'flex';
            if(localStorage.getItem('bingo_victoria_vip') === 'true') activarModoVIP();
            else nuevoCarton();
        }

        function nuevoCarton(data = null) {
            const div = document.createElement('div');
            div.className = 'tablero';
            div.innerHTML = `
                <button style="position:absolute; right:-5px; top:-5px; border-radius:50%; border:none; background:var(--danger); color:white; width:25px; height:25px; font-weight:bold; z-index:10;" onclick="this.parentElement.remove(); guardarCartones();">âœ•</button>
                <div class="cabecera-vip">
                    <input type="text" class="input-info nom-jug" placeholder="JUGADOR" oninput="guardarCartones()" value="${data ? data.jugador : ''}">
                    <div style="display:flex; gap:4px;">
                        <input type="text" class="input-info ser-num" placeholder="SERIE" oninput="guardarCartones()" value="${data ? data.serie : ''}">
                        <input type="text" class="input-info ven-nom" placeholder="VENDEDOR" oninput="guardarCartones()" value="${data ? data.vendedor : ''}">
                    </div>
                </div>
                <div class="cuadricula"></div>
            `;
            const cuad = div.querySelector('.cuadricula');
            for(let i=0; i<25; i++) {
                if(i===12) cuad.innerHTML += `<div class="celda centro">BINGO</div>`;
                else {
                    const inp = document.createElement('input');
                    inp.type = "number"; inp.className = "celda"; inp.inputMode = "numeric";
                    if(data) {
                        inp.value = data.celdas[i].v;
                        if(data.celdas[i].m) inp.className = `celda ${data.celdas[i].col} marcada`;
                    }
                    cuad.appendChild(inp);
                }
            }
            document.getElementById('contenedor').appendChild(div);
            if(esVIP) reordenarInteligente();
        }

        function presionarOK() {
            const num = document.getElementById('numEntrada').value;
            if(!num) return;
            ultimoNumero = num;
            document.querySelectorAll('.celda:not(.centro)').forEach(c => {
                if(c.value == num) c.className = `celda marcado-${colorActual} marcada`;
            });
            document.getElementById('numEntrada').value = "";
            document.getElementById('marcador-visual').innerText = "00";
            if(esVIP) { reordenarInteligente(); guardarCartones(); }
            document.activeElement.blur();
        }

        function reordenarInteligente() {
            if(!esVIP) return;
            const contenedor = document.getElementById('contenedor');
            const tableros = Array.from(contenedor.querySelectorAll('.tablero'));
            tableros.sort((a, b) => b.querySelectorAll('.marcada').length - a.querySelectorAll('.marcada').length);
            tableros.forEach((t, i) => { t.style.order = i; contenedor.appendChild(t); });
        }

        function activarModoVIP() {
            esVIP = true;
            document.body.classList.add('es-vip');
            document.getElementById('btn-estado').innerText = "â˜… VIP ACTIVO";
            document.getElementById('btn-estado').style.background = "#27ae60";
            const data = localStorage.getItem('bingo_db_victoria');
            if(data) {
                document.getElementById('contenedor').innerHTML = "";
                JSON.parse(data).forEach(t => nuevoCarton(t));
            }
        }

        function procesarPago() {
            localStorage.setItem('bingo_victoria_vip', 'true');
            activarModoVIP();
            cerrarModal();
            confetti({ particleCount: 150, spread: 70 });
        }

        function confirmarCancelacion() {
            if(confirm("Â¿Seguro que quieres cancelar tu VIP? PerderÃ¡s el orden automÃ¡tico y los nombres guardados.")) {
                localStorage.removeItem('bingo_victoria_vip');
                localStorage.removeItem('bingo_db_victoria');
                location.reload();
            }
        }

        function guardarCartones() {
            if(!esVIP) return;
            const list = [];
            document.querySelectorAll('.tablero').forEach(t => {
                const celdas = [];
                t.querySelectorAll('.celda').forEach(c => {
                    celdas.push({ 
                        v: c.value || "", 
                        m: c.classList.contains('marcada'),
                        col: Array.from(c.classList).find(cl => cl.startsWith('marcado-')) || 'marcado-amarillo'
                    });
                });
                list.push({ jugador: t.querySelector('.nom-jug').value, serie: t.querySelector('.ser-num').value, vendedor: t.querySelector('.ven-nom').value, celdas });
            });
            localStorage.setItem('bingo_db_victoria', JSON.stringify(list));
        }

        function setCol(c, el) {
            colorActual = c;
            document.querySelectorAll('.dot-color').forEach(d => d.classList.remove('activo'));
            el.classList.add('activo');
        }

        function intentarAÃ±adirTablon() {
            if (esVIP || document.querySelectorAll('.tablero').length < 2) nuevoCarton();
            else abrirVIP();
        }

        function deshacerUltimo() {
            if(!ultimoNumero) return;
            document.querySelectorAll('.celda.marcada').forEach(c => {
                if(c.value == ultimoNumero) c.className = "celda";
            });
            ultimoNumero = "";
            if(esVIP) { reordenarInteligente(); guardarCartones(); }
        }

        function abrirVIP() { document.getElementById('modal-vip').style.display = 'flex'; }
        function cerrarModal() { document.getElementById('modal-vip').style.display = 'none'; }
    </script>
</body>
</html>
